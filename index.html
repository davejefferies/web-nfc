<html>
<head></head>
<body>
<div id="records"></div>
<div id="result"></div>
<script>
test()
async function test() {
	if ('NDEFReader' in window) {
    try {
      const ndef = new NDEFReader();
      await ndef.scan();
      ndef.onreading = async ({ message }) => {
        if (message.records.length == 0 || message.records[0].recordType == "empty") {
          return;
        }
        document.getElementById('records').innerHTML = JSON.stringify(message.records);
        console.log(message.records);
        const decoder = new TextDecoder();
        for (const record of message.records) {
          switch (record.recordType) {
            case "text":
              const textDecoder = new TextDecoder(record.encoding);
              document.getElementById('result').innerHTML = `Text: ${textDecoder.decode(record.data)} (${record.lang})`;
              console.log(`Text: ${textDecoder.decode(record.data)} (${record.lang})`);
              break;
            case "url":
              document.getElementById('result').innerHTML = `URL: ${decoder.decode(record.data)}`;
              break;
            case "mime":
              if (record.mediaType === "application/json") {
                document.getElementById('result').innerHTML = `JSON: ${decoder.decode(record.data)}`;
                console.log(`JSON: ${JSON.parser(decoder.decode(record.data))}`);
              }
              else if (record.mediaType.startsWith("image/")) {
                const blob = new Blob([record.data], { type: record.mediaType });

                const img = document.createElement("img");
                img.src = URL.createObjectURL(blob);
                img.onload = () => window.URL.revokeObjectURL(this.src);

                document.getElementById('result').innerHTML = img;
              }
              else {
                document.getElementById('result').innerHTML = `Media not handled`;
                console.log(`Media not handled`);
              }
              break;
            default:
              document.getElementById('result').innerHTML = `Record not handled`;
              console.log(`Record not handled`);
          }
        }
      };
    } catch (error) {
  console.log(error);
      document.getElementById('result').innerHTML = error
    }
  } else {
    console.log('Web NFC is not available');
    document.getElementById('result').innerHTML = 'Web NFC is not available';
  }
}
</script>
</body>
</html>
